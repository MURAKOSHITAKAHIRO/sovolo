{% extends "container.html" %}
{% load i18n %}

{% block title %}プロフィール編集 | Sovol{% endblock %}

{% block content %}
  {% include "user/user_header.html" %}
  <form action="" class="form-horizontal" method="post" enctype="multipart/form-data">
    <div id="user-detail-info" class="panel panel-primary">
      <div class="panel-body">
        {% csrf_token %}
        <div class="form-group">
          <label for="username-form" class="col-sm-3 col-lg-2 control-label">ニックネーム<br><small><i>(15文字以内)</i></small></label>
          <div class="col-sm-9 col-lg-9"> <input id="username-form" class="form-control" name="username" maxlength="15" value="{{ user.username }}"/> </div>
        </div>
        <div class="form-group">
          <label for="email-form" class="col-sm-3 col-lg-2 control-label">Email</label>
          <div class="col-sm-9 col-lg-9 "> <input id="email-form" class="form-control" name="email" value="{{ user.email }} "/> </div>
        </div>
        <div class="form-group">
          <label for="icon-form" class="col-sm-3 col-lg-2 control-label">プロフィール画像</label>
          <div class="col-sm-9 col-lg-9 ">
            <input class="filestyle" id="icon-form" name="image" type="file" data-buttonName="btn-primary" data-buttonText="選択..."/>
          </div>
          <script type="text/javascript">$('#icon-form').croppieUpload();</script>
        </div>
        <div class="form-group">
          <label for="form-region" class="col-sm-3 col-lg-2 control-label">住んでる都道府県</label>
          <div class="col-sm-9 col-lg-9">
            <select class="form-control" id="form-region" name="region">
              {% for v, pref in user.region_list %}
                <option value="{{ v }}" {% if user.region == v %}selected{% endif %}>{{ pref }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="form-sex" class="col-sm-3 col-lg-2 control-label">性別</label>
          <div class="col-sm-9 col-lg-9">
            <select class="form-control" id="form-sex" name="sex">
              <option value="True" {% if user.sex is True %}selected{% endif %}>男性</option>
              <option value="False" {% if user.sex is False %}selected{% endif %}>女性</option>
              <option value="None" {% if user.sex is None %}selected{% endif %}>秘密</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="form-birthday" class="control-label col-sm-3 col-lg-2">生年月日</label>
          <div class="col-sm-9 col-lg-9">
            <input id="form-birthday" class="form-control" name="birthday" value="{{ user.birthday|date:'Y-m-d' }}" >
            <script>
              $(function () {
                $('#form-birthday').datetimepicker({
                  viewMode: 'years',
                  locale: moment.locale("ja"),
                  format: "YYYY-MM-DD",
                  maxDate: "moment",
                });
              });
            </script>
          </div>
        </div>

        <div class="form-group">
          <label for="form-language" class="control-label col-sm-3 col-lg-2">{% trans 'Language' %}</label>
          <div class="col-sm-9 col-lg-9">
            <select class="form-control" id="form-language" name="language">
              {% for lang in languages %}
                <option value="{{ lang.0 }}"
                  {% if user.language == lang.0 %}
                    selected
                  {% endif %}
                >{{ lang.1 }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 col-lg-2 control-label">フォローしているタグ</label>
            <div class="">
                {% for tag in all_tags %}
                    <label><input type="checkbox" name="tags" value="{{ tag.id }}" {% if tag in request.user.follow_tag.all %}checked{% endif %}>{{ tag.name }}</label>
                {% endfor %}
            </div>
        </div>
        
        <div class="form-group">
          <label class="col-sm-3">ボランティアしたいこと</label>
          <div class="col-sm-9">
            <div id="frames">
              {% for frame in user.frame_set.all %}
                <div class="panel panel-default panel-body" style="margin:0">
                  <div class="row">
                    <input type="hidden" name="frame_number" value="{{ forloop.counter }}">
                    {% if not request.GET.copy_user_id %}
                      <input type="hidden" name="frame_{{ forloop.counter }}_id" value="{{ frame_id }}">
                    {% endif %}
                    <label class="col-sm-3">タグ</label>
                    <div class="checkbox col-sm-9">
                      {% for tag in all_tags %}
                        <label><input type="checkbox" name="tags" value="{{ tag.id }}"
                          {% if tag in frame.tag.all %}checked{% endif %}>{{ tag.name }}</label>
                      {% endfor %}
                    </div>
                    <label class="col-sm-3">できる内容</label>
                    <div class="col-sm-9">
                      <textarea class="form-control" name="frame_{{ forloop.counter }}_user_todo">{{ frame.user_todo }}</textarea>
                    </div>
                  </div>
                </div>
                {% empty %}
                <div class="panel panel-default panel-body" style="margin:0">
                  <div class="row">
                    <input type="hidden" name="frame_number" value="1">
                    <!--<input type="hidden" name="frame_1_id" value="{{ frame.id }}">-->
                    <label class="col-sm-3">タグ<sup><font color="red"></font></sup></label>
                    <div class="checkbox col-sm-9">↲
                      {% for tag in all_tags %}↲
                      <label><input type="checkbox" name="tags" value="{{ tag.id     }}"↲
                        {% if tag in frame.tag.all %}checked{% endif %}>{{ tag.name }}</label>↲
                      {% endfor %}↲
                     </div>↲
                     <label class="col-sm-3">できる内容</label>↲
                     <div class="col-sm-9">↲
                       <textarea class="form-control"  name="frame_{{ forloop.counter     }}_user_todo">{{ frame.user_todo }}</textarea>↲
                     </div>↲
                    </div>↲
                  </div>↲
              {% endfor %}

            </div>
            <button class="btn btn-primary pull-right" id="add_frame" type="button">

              <span class="glyphicon glyphicon-plus"></span>
            </button>
              <script>
              $(function () {
                  $('#add_frame').on('click', function (event) {
                      var X = $('#frames>div').length + 1;

                      var tmpl = Handlebars.compile($('#tmpl-frame').html());

                      $wrapper = $('<div>');
                      $wrapper.html(tmpl({X: X}));
                      $('#frames').append($wrapper);
                    });
                });
              </script>

            <button class="btn btn-primary pull-right" id="delete_frame" type="button">
              <span class="glyphicon glyphicon-minus"></span>
            </button>
              <script>
              $('#delete_frame').click(function() {
                  $wrapper = $('<div>');
                  $('#frames div.panel:last').remove();
             });
              </script>
            </div>
          </div>
        {% verbatim %}
        <script id="tmpl-frame" type="text/x-handlebars-template">
          <div class="panel panel-default panel-body" style="margin:0" id="frame_number_{{ X }}">
            <input type="hidden" name="frame_number" value="{{ X }}">
            <label class="col-sm-3">タグ<sup><font color="red"></font></sup></label>
            {% for tag in user.frame_set.all %}
              <div class="checkbox col-sm-9">
              
              <label><input type="checkbox" name="tags" value="{{ tag.id }}"{% if tag in request.user.follow_tag.all %}checked{% endif %}>{{ tag.name }}</label>
                {% endfor %}
              </div>
              <label class="col-sm-3">できる内容</label>
              <div class="col-sm-9">
                <textarea class="form-control" name="frame_{{ X }}_user_todo"></textarea>
            <script>
              (function () {
                  $("#frame_number_{{ X }} .datetimepicker").datetimepicker({
                      locale: moment.locale("ja"),
                      format:"YYYY\MM\DD HH:mm",
                      sideBySide:true,
                      minDate: moment(),
                      stepping: 15
                    });
                })();
              <{{!}}/script>
            </div>
          </div>
        </div>
       </script>
       {% endverbatim %}
      
        <div class="form-group">
          <label for="usertodo-form" class="col-sm-3 col-lg-2 control-label">できること</label>
            <div class="col-sm-9 col-lg-9"><input id="usertodo-form" type="text"  class="form-control" name="user_todo" maxlength="1000" value="{{ user.user_todo }}"/></div>
        </div>
        <input type="button" onclick="location.href='../request_password_reset'" value="passwordを変更する">
        <div class="row">
          <input type="submit" class="btn btn-primary btn-lg col-sm-4 col-sm-offset-4 col-lg-2 col-lg-offset-5 col-xs-8 col-xs-offset-2" value="適用"/>
        </div>
      </div>
    </div>
  </form>
{% endblock %}
