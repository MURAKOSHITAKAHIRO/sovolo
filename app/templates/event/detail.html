{% extends "base.html" %}
{% load bootstrap3 %}
{% load event_tags %}

{% block title %}{{ event.name }} ボランティア詳細 | Sovol{% endblock %}
{% block content %}
  <div>
    {% include "event/event_header.html" %}
    <div class="row">
      <div class="col-md-9">

        <div class="panel panel-primary">
          <div class="panel-heading">
            参加状況
          </div>
          <div class="panel-body">
            <div class="list-group">
              {% for frame in event.frame_set.all %}
              <li class="list-group-item">
                <div class="row">
                  <div class="col-md-9">
                    <h5>参加枠{{ forloop.counter }}: (締切: {{ frame.deadline_format }})
                      {% if request.user in event.admin.all %}<!-- 管理者 -->
                      {% elif request.user.id in frame.reserved_id_list %}<!--参加予定-->
                        {% if frame.is_over %}<!--参加予定/終了-->
                          <span class="label label-info">参加しました</span>
                        {% elif frame.is_started %}<!--参加予定/開催中-->
                          <span class="label label-info">参加中</span>
                        {% elif frame.is_closed %}<!--参加予定/締切済-->
                          <span class="label label-info">参加確定</span>
                        {% else %}<!--参加予定/募集中-->
                          <span class="label label-info">参加予定</span>
                        {% endif %}
                      {% elif request.user.id in frame.waiting_id_list %}<!--キャンセル待ち-->
                        {% if frame.is_over %}<!--キャンセル待ち/終了-->
                          <span class="label label-info">終了しました</span>
                        {% elif frame.is_started %}<!--キャンセル待ち/開催中-->
                          <span class="label label-info">参加不可</span>
                        {% elif frame.is_closed %}<!--キャンセル待ち/締切済-->
                          <span class="label label-info">参加不可</span>
                        {% else %}<!--キャンセル待ち/募集中-->
                          <span class="label label-info">キャンセル待ち</span>
                        {% endif %}
                      {% else %}<!--未応募 -->
                        {% if frame.is_over %}<!--未応募/終了-->
                          <span class="label label-info">終了しました</span>
                        {% elif frame.is_started %}<!--未応募/開催中-->
                          <span class="label label-info">開催中</span>
                        {% elif frame.is_closed %}<!--未応募/締切済-->
                          <span class="label label-info">参加不可</span>
                        {% else %}<!--未応募/募集中-->
                          {% if frame.is_full %}<!--未応募/募集中/参加枠満員-->
                          {% else %}<!--未応募/募集中/参加枠満員-->
                          {% endif %}
                        {% endif %}
                      {% endif %}
                    </h5>
                    {{ frame.description }}
                  </div>

                  <div class="col-md-3">
                    <div>
                      {% if request.user in event.admin.all %}<!-- 管理者 -->
                      {% elif request.user.id in frame.reserved_id_list %}<!--参加予定-->
                        {% if frame.is_over %}<!--参加予定/終了-->
                        {% elif frame.is_started %}<!--参加予定/開催中-->
                        {% elif frame.is_closed %}<!--参加予定/締切済-->
                          <form method="post" action="{% url 'event:cancel' event.id %}">
                            {% csrf_token %}
                            <button class="btn btn-primary">キャンセル</button>
                          </form>
                        {% else %}<!--参加予定/募集中-->
                          <form method="post" action="{% url 'event:cancel' event.id %}">
                            {% csrf_token %}
                            <button class="btn btn-primary">キャンセル</button>
                          </form>
                        {% endif %}
                      {% elif request.user.id in frame.waiting_id_list %}<!--キャンセル待ち-->
                        {% if frame.is_over %}<!--キャンセル待ち/終了-->
                        {% elif frame.is_started %}<!--キャンセル待ち/開催中-->
                          <button class="btn btn-primary" disabled>締切済</button>
                        {% elif frame.is_closed %}<!--キャンセル待ち/締切済-->
                          <button class="btn btn-primary" disabled>締切済</button>
                        {% else %}<!--キャンセル待ち/募集中-->
                          <form method="post" action="{% url 'event:cancel' event.id %}">
                            {% csrf_token %}
                            <button class="btn btn-primary">キャンセル</button>
                          </form>
                        {% endif %}
                      {% else %}<!--未応募 -->
                        {% if frame.is_over %}<!--未応募/終了-->
                        {% elif frame.is_started %}<!--未応募/開催中-->
                          <button class="btn btn-primary" disabled>締切済</button>
                        {% elif frame.is_closed %}<!--未応募/締切済-->
                          <button class="btn btn-primary" disabled>締切済</button>
                        {% else %}<!--未応募/募集中-->
                          {% if frame.is_full %}<!--未応募/募集中/参加枠満員-->
                            <a href="{% url 'event:participate' event.id frame.id %}" class="btn btn-primary">キャンセル待ち</a>
                          {% else %}<!--未応募/募集中/参加枠空き有-->
                            <a href="{% url 'event:participate' event.id frame.id %}" class="btn btn-primary">参加</a>
                          {% endif %}
                        {% endif %}
                      {% endif %}
                    </div>
                    <br>
                    <div>
                      {% if not frame.upper_limit is None %}
                      <font size="4">
                        {{ frame.num_participants }}人
                        /{{ frame.upper_limit }}人
                      </font>
                      {% else %}
                      <font size="4">
                        {{ frame.num_participants }}人
                      </font>
                      <span class="label label-warning">上限なし</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </li>
              {% endfor %}
            </div>
          </div>
        </div>


        {% if event.private_notes and request.user in event.participant.all %}
          <div class="panel panel-primary">
            <div class="panel-heading">
              参加者への連絡事項（応募していないユーザには見えません）
            </div>
            <div class="panel-body">
              {{ event.private_notes }}
            </div>
          </div>
        {% endif %}

        <div class="panel panel-primary">
          <div class="panel-heading">募集詳細</div>
          <div class="panel-body">
            <table class="table">
              <tr>
                <th>日時</th>
                <td>{{ event.start_time_format }} ～ {{ event.end_time_format }}</td>
              </tr>
              <tr>
                <th>説明</th>
                <td>{{ event.details | linebreaks }}</td>
              </tr>
              <tr>
                <th>連絡事項</th>
                <td>{{ event.notes | linebreaks }}</td>
              </tr>
              <tr>
                <th>集合場所</th>
                <td>{{ event.get_region_kanji }} {{ event.meeting_place }}</td>
              </tr>
              <tr>
                <th>連絡先</th>
                <td>{{ event.contact }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        {% include "event/side_info.html" %}
      </div>
    </div>
    {% comments event %}
  </div>

{% endblock %}
